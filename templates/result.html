<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MedAssist AI â€“ Result</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<!-- TOP CONTROLS -->
<button id="dark-toggle" title="Dark Mode">ğŸŒ™</button>
<button id="speak-btn" title="Speak">ğŸ”Š</button>

<div class="container">

    <!-- HEADER -->
    <div class="header">
        <h1>ğŸ©º MedAssist AI</h1>
        <p>Your Community Health Assistant</p>
    </div>

    <!-- AI GUIDANCE -->
    <div class="card assistant-card">
        <h2>ğŸ¤– AI Health Guidance</h2>
        <p id="assistant-text">
            {{ health if health else "General health guidance is provided based on your input." }}
        </p>
    </div>

    <!-- RECOMMENDED DOCTOR -->
    <div class="card doctor-box">
        <h2>ğŸ‘¨â€âš•ï¸ Recommended Doctor</h2>
        <p class="doctor-name">{{ doctor }}</p>
        <p>{{ reason }}</p>
    </div>

    <!-- SORT -->
    <div class="card">
        <strong>Sort by:</strong>
        <select id="sortSelect">
            <option value="distance">Distance</option>
            <option value="type">Type</option>
        </select>
    </div>

    <!-- MEDICAL PLACES -->
    <div class="card">
        <h2>ğŸ¥ Nearby Hospitals & Doctors</h2>

        <div id="places-container">
            {% for p in medical_places %}
            <div class="hospital"
                 data-distance="{{ p.distance }}"
                 data-type="{{ p.type }}">

                <div>
                    <strong>{{ p.name }}</strong><br>
                    {{ p.type }} â€¢ {{ p.specialty }}<br>
                    â­ {{ p.rating }} | {{ p.distance }} km
                </div>

                <div style="display:flex; flex-direction:column; gap:6px;">
                    <a class="map-btn" href="{{ p.map }}" target="_blank">Map</a>
                    <a class="map-btn" href="{{ p.booking.google }}" target="_blank">
                        Book Appointment
                    </a>
                </div>
            </div>
            {% else %}
            <p>No nearby medical facilities found.</p>
            {% endfor %}
        </div>
    </div>

    <!-- SEARCH AGAIN -->
    <div class="search-again">
        <a href="/">ğŸ” Search Again</a>
    </div>

</div>

<!-- FLOATING CHAT -->
<div id="chat-bubble">ğŸ’¬</div>

<div id="chat-box">
    <div class="chat-header">MedAssist Help</div>
    <div class="chat-body" id="chat-body">
        <div class="bot-msg">
            Hi ğŸ‘‹ I can explain results, guide next steps, or answer general health questions.
        </div>
    </div>
    <div class="chat-input">
        <input type="text" id="chat-input" placeholder="Ask somethingâ€¦">
        <button onclick="sendMessage()">â¤</button>
    </div>
</div>

<!-- SORT SCRIPT -->
<script>
function sortPlaces() {
    const container = document.getElementById("places-container");
    const cards = Array.from(container.children);
    const sortBy = document.getElementById("sortSelect").value;

    cards.sort((a, b) => {
        if (sortBy === "distance") {
            return parseFloat(a.dataset.distance) - parseFloat(b.dataset.distance);
        }
        return a.dataset.type.localeCompare(b.dataset.type);
    });

    cards.forEach(c => container.appendChild(c));
}
document.getElementById("sortSelect").addEventListener("change", sortPlaces);
</script>

<script src="{{ url_for('static', filename='assistant.js') }}"></script>
</body>
</html>
